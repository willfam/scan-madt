<div class class="start-trip-page">
    @if (step === 0) {
        @if (startTripData.type === tripTypeDetails.FMS_TRIP_INFO_MISMATCH) {
            <ng-container>
                <div class="warning-box">
                    <div class="warning-icon">
                        <img src="/assets/images/svg/bell.svg" />
                    </div>
                    <div class="warning-text">{{ 'UNABLE_TO_FIND_FARE' | translate }}</div>
                </div>
                <div class="page-header">
                    <div class="back-button" (click)="backToBusOperation()">{{ 'BACK' | translate }}</div>
                </div>
                <div class="trip-detail-box mt--50">
                    <div class="trip-detail-header">
                        <div class="title ht">
                            <img src="/assets/images/svg/fms-trip-details-icon.svg" />
                            {{ 'FMS_TRIP_DETAILS' | translate }}
                        </div>
                    </div>
                    <div class="trip-detail-content">
                        <ul>
                            <li class="row">
                                <div class="left">{{ 'SERVICE' | translate }}</div>
                                <div class="right">
                                    <p class="value">
                                        @if (startTripData.fms?.serviceNumber) {
                                            {{ startTripData.fms?.serviceNumber }}
                                            {{ startTripData.fms?.variantName || '' }}
                                        }
                                    </p>
                                </div>
                            </li>
                            <li class="row">
                                <div class="left">{{ 'BUS_STOP' | translate }}</div>
                                <div class="right">
                                    <p class="value">{{ startTripData.fms?.busStop?.['Name'] }}</p>
                                </div>
                            </li>
                            <li class="row">
                                <div class="left">{{ 'DIRECTION' | translate }}</div>
                                <div class="right">
                                    <p class="value">{{ startTripData.fms?.dir }}</p>
                                </div>
                            </li>
                        </ul>
                        <div class="msg" [innerHTML]="'FMS_TRIP_DETAILS_CAPTION' | translate"></div>
                        <div class="btn-group">
                            <button class="btn btn-confirm" (click)="navigateToStep(1)">
                                <!-- <img src="/assets/images/svg/docs-icon.svg" alt="" /> -->
                                <span class="text">
                                    {{ 'PROCEED' | translate }}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>
        } @else if (startTripData.type === tripTypeDetails.FMS_BUS_STOP_MISMATCH) {
            <ng-container>
                <div class="warning-box">
                    <div class="warning-icon">
                        <img src="/assets/images/svg/bell.svg" />
                    </div>
                    <div class="warning-text">{{ 'BUS_STOP_MISMATCH' | translate }}</div>
                </div>
                <div class="page-header">
                    <div class="back-button" (click)="backToBusOperation()">{{ 'BACK' | translate }}</div>
                </div>
                <div class="trip-detail-box mt--50">
                    <div class="trip-detail-header">
                        <div class="title ht">
                            <img src="/assets/images/svg/fms-trip-details-icon.svg" />
                            {{ 'FMS_TRIP_DETAILS' | translate }}
                        </div>
                    </div>
                    <div class="trip-detail-content">
                        <ul>
                            <li class="row">
                                <div class="left">{{ 'SERVICE' | translate }}</div>
                                <div class="right">
                                    <p class="value">
                                        @if (startTripData.fms?.serviceNumber) {
                                            {{ startTripData.fms?.serviceNumber }}
                                            {{ startTripData.fms?.variantName || '' }}
                                        }
                                    </p>
                                </div>
                            </li>
                            <li class="row">
                                <div class="left">{{ 'BUS_STOP' | translate }}</div>
                                <div class="right">
                                    <p class="value">{{ startTripData.fms?.busStop?.['Name'] }}</p>
                                </div>
                            </li>
                            <li class="row">
                                <div class="left">{{ 'DIRECTION' | translate }}</div>
                                <div class="right">
                                    <p class="value">{{ startTripData.fms?.dir }}</p>
                                </div>
                            </li>
                        </ul>
                        <div class="msg" [innerHTML]="'FMS_TRIP_DETAILS_CAPTION' | translate"></div>
                        <div class="btn-group">
                            <button class="btn btn-confirm" (click)="handleSettingFareDetails()">
                                <!-- <img src="/assets/images/svg/docs-icon.svg" alt="" /> -->
                                <span class="text">
                                    {{ 'PROCEED' | translate }}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>
        }
    }
    <ng-container *ngIf="step === 1">
        @if (startTripData.type === tripTypeDetails.FMS_VALID_INFO) {
            <ng-container>
                <div class="page-header">
                    <div class="back-button" (click)="backToBusOperation()">{{ 'BACK' | translate }}</div>
                </div>
                <div class="trip-detail-box">
                    <div class="trip-detail-header">
                        <div class="title ht">
                            <img src="/assets/images/svg/fms-trip-details-icon.svg" />
                            {{ 'FMS_TRIP_DETAILS' | translate }}
                        </div>
                    </div>
                    <div class="trip-detail-content">
                        <ul>
                            <li class="row">
                                <div class="left">{{ 'SERVICE' | translate }}</div>
                                <div class="right">
                                    <p class="value">
                                        @if (startTripData.fms?.serviceNumber) {
                                            {{ startTripData.fms?.serviceNumber }}
                                            {{ startTripData.fms?.variantName || '' }}
                                        }
                                    </p>
                                </div>
                            </li>
                            <li class="row">
                                <div class="left">{{ 'BUS_STOP' | translate }}</div>
                                <div class="right">
                                    <p class="value">{{ startTripData.fms?.busStop?.['Name'] }}</p>
                                </div>
                            </li>
                            <li class="row">
                                <div class="left">{{ 'DIRECTION' | translate }}</div>
                                <div class="right">
                                    <p class="value">{{ startTripData.fms?.dir }}</p>
                                </div>
                            </li>
                        </ul>

                        <div class="btn-group">
                            <button class="btn btn-confirm" (click)="handleConfirmStartTrip('fms')">
                                <img src="/assets/images/icons/main/confirm.svg" alt="" />
                                <span class="text">
                                    {{ 'PROCEED' | translate }}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>
        } @else if (startTripData.type === tripTypeDetails.FMS_NO_INFO) {
            <div class="trip-detail-box">
                <div class="trip-detail-header">
                    <div class="title ht">
                        <img src="/assets/images/svg/fare-trip-details-icon.svg" />
                        {{ 'FARE_TRIP_DETAILS' | translate }}
                    </div>
                </div>
                <div class="trip-detail-content">
                    <ul>
                        <li class="row">
                            <div class="left">{{ 'SERVICE' | translate }}</div>
                            <div
                                class="right"
                                (click)="handleChange('service')"
                                [ngClass]="{
                                    required: !startTripData.fare?.serviceNumber
                                }"
                            >
                                <p class="value">
                                    @if (startTripData.fare?.serviceNumber) {
                                        {{ startTripData.fare?.serviceNumber }}
                                        {{ startTripData.fare?.variantName || '' }}
                                    } @else {
                                        {{ 'SELECT_SERVICE' | translate }}
                                    }
                                </p>
                                <img src="/assets/images/icons/main/chevron-right.svg" alt="" />
                            </div>
                        </li>
                        <li class="row">
                            <div class="left">{{ 'BUS_STOP' | translate }}</div>
                            <div
                                class="right"
                                (click)="handleChange('busStop')"
                                [ngClass]="{
                                    required: !startTripData.fare?.busStop?.['Name'],
                                    disabled: !startTripData.fare?.serviceNumber
                                }"
                            >
                                <p class="value">
                                    @if (startTripData.fare?.busStop?.['Name']) {
                                        {{ startTripData.fare?.busStop?.['Name'] }}
                                    } @else {
                                        {{ 'SELECT_BUS_STOP' | translate }}
                                    }
                                </p>
                                <img src="/assets/images/icons/main/chevron-right.svg" alt="" />
                            </div>
                        </li>
                        <li class="row">
                            <div class="left">{{ 'DIRECTION' | translate }}</div>
                            <div class="right">
                                <p class="value">{{ startTripData.fare?.dir }}</p>
                            </div>
                        </li>
                    </ul>

                    <div class="btn-group">
                        <button class="btn btn-cancel" (click)="backToBusOperation()">
                            <img src="/assets/images/icons/main/close.svg" alt="" />
                            <span>{{ 'CANCEL' | translate }}</span>
                        </button>
                        <button
                            class="btn btn-confirm"
                            [disabled]="!startTripData.fare?.busStop?.Name || !startTripData.fare?.serviceNumber"
                            (click)="navigateToStep(4)"
                        >
                            <img src="/assets/images/icons/main/confirm.svg" alt="" />
                            <span class="text">
                                {{ 'CONFIRM' | translate }}
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        } @else if (startTripData.type === tripTypeDetails.FMS_TRIP_INFO_MISMATCH) {
            <div class="trip-detail-box">
                <div class="trip-detail-header">
                    <div class="title ht">
                        <img src="/assets/images/svg/fare-trip-details-icon.svg" />
                        {{ 'FARE_TRIP_DETAILS' | translate }}
                    </div>
                </div>
                <div class="trip-detail-content">
                    <ul>
                        <li class="row">
                            <div class="left">{{ 'SERVICE' | translate }}</div>
                            <div
                                class="right"
                                (click)="handleChange('service')"
                                [ngClass]="{
                                    required: !startTripData.fare?.serviceNumber
                                }"
                            >
                                <p class="value">
                                    @if (startTripData.fare?.serviceNumber) {
                                        {{ startTripData.fare?.serviceNumber }}
                                        {{ startTripData.fare?.variantName || '' }}
                                    } @else {
                                        {{ 'SELECT_SERVICE' | translate }}
                                    }
                                </p>
                                <img src="/assets/images/icons/main/chevron-right.svg" alt="" />
                            </div>
                        </li>
                        <li class="row">
                            <div class="left">{{ 'BUS_STOP' | translate }}</div>
                            <div
                                class="right"
                                (click)="handleChange('busStop')"
                                [ngClass]="{
                                    required: !startTripData.fare?.busStop?.['Name'],
                                    disabled: !startTripData.fare?.serviceNumber
                                }"
                            >
                                <p class="value">
                                    @if (startTripData.fare?.busStop?.['Name']) {
                                        {{ startTripData.fare?.busStop?.['Name'] }}
                                    } @else {
                                        {{ 'SELECT_BUS_STOP' | translate }}
                                    }
                                </p>
                                <img src="/assets/images/icons/main/chevron-right.svg" alt="" />
                            </div>
                        </li>
                        <li class="row">
                            <div class="left">{{ 'DIRECTION' | translate }}</div>
                            <div class="right">
                                <p class="value">{{ startTripData.fare?.dir }}</p>
                            </div>
                        </li>
                    </ul>

                    <div class="btn-group">
                        <button class="btn btn-cancel" (click)="backToBusOperation()">
                            <img src="/assets/images/icons/main/close.svg" alt="" />
                            <span>{{ 'CANCEL' | translate }}</span>
                        </button>
                        <button
                            class="btn btn-confirm"
                            [disabled]="!startTripData.fare?.busStop?.Name || !startTripData.fare?.serviceNumber"
                            (click)="handleConfirmStartTrip()"
                        >
                            <img src="/assets/images/icons/main/confirm.svg" alt="" />
                            <span class="text">
                                {{ 'CONFIRM' | translate }}
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        } @else if (startTripData.type === tripTypeDetails.FMS_BUS_STOP_MISMATCH) {
            <div class="trip-detail-box">
                <div class="trip-detail-header">
                    <div class="title ht">
                        <img src="/assets/images/svg/fare-trip-details-icon.svg" />
                        {{ 'FARE_TRIP_DETAILS' | translate }}
                    </div>
                </div>
                <div class="trip-detail-content">
                    <ul>
                        <li class="row">
                            <div class="left">{{ 'SERVICE' | translate }}</div>
                            <div
                                class="right"
                                [ngClass]="{
                                    required: !startTripData.fare?.serviceNumber
                                }"
                            >
                                <p class="value">
                                    @if (startTripData.fare?.serviceNumber) {
                                        {{ startTripData.fare?.serviceNumber }}
                                        {{ startTripData.fare?.variantName || '' }}
                                    } @else {
                                        {{ 'SELECT_SERVICE' | translate }}
                                    }
                                </p>
                            </div>
                        </li>
                        <li class="row">
                            <div class="left">{{ 'BUS_STOP' | translate }}</div>
                            <div
                                class="right"
                                (click)="handleChange('busStop')"
                                [ngClass]="{
                                    required: !startTripData.fare?.busStop?.['Name'],
                                    disabled: !startTripData.fare?.serviceNumber
                                }"
                            >
                                <p class="value">
                                    @if (startTripData.fare?.busStop?.['Name']) {
                                        {{ startTripData.fare?.busStop?.['Name'] }}
                                    } @else {
                                        {{ 'SELECT_BUS_STOP' | translate }}
                                    }
                                </p>
                                <img src="/assets/images/icons/main/chevron-right.svg" alt="" />
                            </div>
                        </li>
                        <li class="row">
                            <div class="left">{{ 'DIRECTION' | translate }}</div>
                            <div class="right">
                                <p class="value">{{ startTripData.fare?.dir }}</p>
                            </div>
                        </li>
                    </ul>

                    <div class="btn-group">
                        <button class="btn btn-cancel" (click)="backToBusOperation()">
                            <img src="/assets/images/icons/main/close.svg" alt="" />
                            <span>{{ 'CANCEL' | translate }}</span>
                        </button>
                        <button
                            class="btn btn-confirm"
                            [disabled]="!startTripData.fare?.busStop?.Name || !startTripData.fare?.serviceNumber"
                            (click)="handleConfirmStartTrip()"
                        >
                            <img src="/assets/images/icons/main/confirm.svg" alt="" />
                            <span class="text">
                                {{ 'CONFIRM' | translate }}
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        }
    </ng-container>

    <ng-container *ngIf="step === 2">
        <div class="page-header">
            <div class="back-button" (click)="navigateToStep(1)">{{ 'BACK' | translate }}</div>
        </div>
        <div *ngIf="currentValueChange === 'busStop'" class="bus-stop">
            <h2 class="title">
                {{ 'SELECT_BUS_STOP' | translate }}
            </h2>
            <div class="content">
                @if (!busStops.length) {
                    <div class="loading">
                        <img class="loader" src="/assets/images/svg/spinner.svg" alt="" />
                        <div>Loading...</div>
                    </div>
                } @else {
                    <div class="scrollbar">
                        <ng-scrollbar
                            #scrollable
                            [buttons]="true"
                            trackClass="scrollbar-track"
                            thumbClass="scrollbar-thumb"
                            buttonClass="scrollbar-button"
                        >
                            <ul class="bus-stop-list">
                                @for (busStop of busStops; track busStop.Busid) {
                                    <li
                                        [ngClass]="{
                                            selected: selectedBusStop === busStop.Busid
                                        }"
                                        (click)="handleSelectBusStop(busStop.Busid)"
                                    >
                                        {{ busStop.Name }}
                                    </li>
                                }
                            </ul>
                        </ng-scrollbar>
                    </div>
                }
            </div>
            <div class="btn-group">
                <button class="btn btn-confirm" [disabled]="!selectedBusStop" (click)="handleUpdateBusStop()">
                    <img src="/assets/images/icons/main/confirm.svg" alt="" />
                    <span class="text">{{ 'CONFIRM' | translate }}</span>
                </button>
            </div>
        </div>
        <div *ngIf="currentValueChange === 'service'" class="services">
            <h2 class="title">
                {{ 'SELECT_SERVICES' | translate }}
            </h2>
            <div class="additional-service" (click)="handleDisplayManuallyInputPopUp()">
                <img src="/assets/images/icons/bus-operation/additional-service.svg" alt="" />
                <h3 class="text-underline">{{ 'INPUT_SERVICE_ID_MANUALLY' | translate }}</h3>
            </div>
            <div class="content">
                @if (!services.length) {
                    <div class="loading">
                        <img class="loader" src="/assets/images/svg/spinner.svg" alt="" />
                        <div>Loading...</div>
                    </div>
                } @else {
                    <div class="scrollbar">
                        <ng-scrollbar
                            #scrollable
                            [buttons]="true"
                            trackClass="scrollbar-track"
                            thumbClass="scrollbar-thumb"
                            buttonClass="scrollbar-button"
                        >
                            <ul class="bus-stop-list">
                                @for (service of services; track service.serviceNumber) {
                                    <li
                                        [ngClass]="{
                                            selected: selectedService === service
                                        }"
                                        (click)="handleSelectService(service)"
                                    >
                                        {{ service.serviceNumber }} - {{ service.variantName }}
                                    </li>
                                }
                            </ul>
                        </ng-scrollbar>
                    </div>
                }
            </div>
            <div class="btn-group">
                <button
                    class="btn btn-confirm"
                    [disabled]="!selectedService.serviceNumber"
                    (click)="handleUpdateService()"
                >
                    <img src="/assets/images/icons/main/confirm.svg" alt="" />
                    <span class="text">{{ 'CONFIRM' | translate }}</span>
                </button>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="step === 3">
        <div class="page-header">
            <div class="back-button" (click)="navigateToStep(2)">{{ 'BACK' | translate }}</div>
        </div>
        <div class="service-input">
            <div class="content">
                <div class="additional-service">
                    <h3>{{ 'INPUT_SERVICE_ID_MANUALLY' | translate }}</h3>
                </div>
                <div class="input-group">
                    <p>{{ 'SERVICE_ID' | translate }}</p>
                    <input id="inputField" />
                    <p class="text-error" *ngIf="manualServiceIdError || startTripData.status === ResponseStatus.ERROR">
                        {{ 'ERROR_SERVICE_ID_INVALID' | translate }}
                    </p>
                </div>
            </div>
            <div class="keyboard">
                <custom-keyboard [layout]="'numeric'" (onKeyPress)="handleChangeInput($event)"></custom-keyboard>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="step === 4">
        <div class="confirm m-w">
            <div class="confirm-header">{{ 'STARTING_FARE_TRIP_WO_FMS' | translate }}</div>
            <p class="confirm-msg">
                {{ 'PRESS_CONFIRM_TO_START_TRIP' | translate }}
            </p>
            <div class="btn-group">
                <div class="btn btn-cancel" (click)="backToPreviousScreen()">
                    <img src="/assets/images/icons/main/close.svg" alt="" />
                    <span>{{ 'CANCEL' | translate }}</span>
                </div>
                <div class="btn btn-confirm" (click)="handleConfirmStartTrip()">
                    <img src="/assets/images/icons/main/confirm.svg" alt="" />
                    <span>{{ 'CONFIRM' | translate }}</span>
                </div>
            </div>
        </div>
    </ng-container>
</div>
