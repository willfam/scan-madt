import { Directive, Input, Output, inject, signal, effect, computed, numberAttribute, booleanAttribute, runInInjectionContext, input, EventEmitter, ElementRef, NgZone, Injector } from '@angular/core';
import { Platform } from '@angular/cdk/platform';
import { Directionality } from '@angular/cdk/bidi';
import { toSignal } from '@angular/core/rxjs-interop';
import { map, tap } from 'rxjs';
import { SmoothScrollManager } from 'ngx-scrollbar/smooth-scroll';
import { NG_SCROLLBAR } from './utils/scrollbar-base';
import { resizeObserver, ViewportAdapter } from './viewport';
import { ScrollbarUpdateReason, NG_SCROLLBAR_OPTIONS } from './ng-scrollbar.model';
import * as i0 from "@angular/core";
const defaultOptions = {
    trackClass: '',
    thumbClass: '',
    buttonClass: '',
    orientation: 'auto',
    appearance: 'native',
    visibility: 'native',
    position: 'native',
    trackScrollDuration: 50,
    sensorThrottleTime: 0,
    disableSensor: false,
    disableInteraction: false,
    buttons: false,
    hoverOffset: false
};
export class NgScrollbarCore {
    constructor() {
        /** Injected options */
        this.injectedOptions = inject(NG_SCROLLBAR_OPTIONS, { optional: true });
        /** Combine injected option with default options */
        this.options = this.injectedOptions ? { ...defaultOptions, ...this.injectedOptions } : defaultOptions;
        this.zone = inject(NgZone);
        this.platform = inject(Platform);
        this.injector = inject(Injector);
        /** A flag that indicates if the platform is mobile */
        this.isMobile = this.platform.IOS || this.platform.ANDROID;
        this.dir = inject(Directionality);
        this.smoothScroll = inject(SmoothScrollManager);
        this.nativeElement = inject((ElementRef)).nativeElement;
        /**
         * Indicates when scrollbar thumb is being dragged
         */
        this.dragging = signal('none');
        /**
         * Sets the supported scroll track of the viewport, there are 3 options:
         *
         * - `vertical` Use both vertical and horizontal scrollbar
         * - `horizontal` Use both vertical and horizontal scrollbar
         * - `auto` Use both vertical and horizontal scrollbar
         */
        this.orientation = input(this.options.orientation);
        /**
         * When to show the scrollbar, and there are 3 options:
         *
         * - `native` (default) Scrollbar will be visible when viewport is scrollable like with native scrollbar
         * - `hover` Scrollbars are hidden by default, only visible on scrolling or hovering
         * - `always` Scrollbars are always shown even if the viewport is not scrollable
         */
        this.visibility = input(this.options.visibility);
        /** Show scrollbar buttons */
        this.buttons = input(this.options.buttons, {
            transform: booleanAttribute
        });
        /** Disables scrollbar interaction like dragging thumb and jumping by track click */
        this.disableInteraction = input(this.options.disableInteraction, {
            transform: booleanAttribute
        });
        /** Whether ResizeObserver is disabled */
        this.disableSensor = input(this.options.disableSensor, {
            transform: booleanAttribute
        });
        /** Throttle interval for detecting changes via ResizeObserver */
        this.sensorThrottleTime = input(this.options.sensorThrottleTime, {
            transform: numberAttribute
        });
        /** A flag used to activate hover effect on the offset area around the scrollbar */
        this.hoverOffset = input(this.options.hoverOffset, {
            transform: booleanAttribute
        });
        this.viewportDimension = signal({
            contentHeight: 0,
            contentWidth: 0,
            offsetHeight: 0,
            offsetWidth: 0
        });
        this.state = computed(() => {
            let verticalUsed = false;
            let horizontalUsed = false;
            let isVerticallyScrollable = false;
            let isHorizontallyScrollable = false;
            const orientation = this.orientation();
            const visibility = this.visibility();
            const viewport = this.viewportDimension();
            // Check if vertical scrollbar should be displayed
            if (orientation === 'auto' || orientation === 'vertical') {
                isVerticallyScrollable = viewport.contentHeight > viewport.offsetHeight;
                verticalUsed = visibility === 'visible' || isVerticallyScrollable;
            }
            // Check if horizontal scrollbar should be displayed
            if (orientation === 'auto' || orientation === 'horizontal') {
                isHorizontallyScrollable = viewport.contentWidth > viewport.offsetWidth;
                horizontalUsed = visibility === 'visible' || isHorizontallyScrollable;
            }
            return {
                verticalUsed,
                horizontalUsed,
                isVerticallyScrollable,
                isHorizontallyScrollable,
            };
        });
        this.isVerticallyScrollable = computed(() => this.state().isVerticallyScrollable);
        this.isHorizontallyScrollable = computed(() => this.state().isHorizontallyScrollable);
        this.verticalUsed = computed(() => this.state().verticalUsed);
        this.horizontalUsed = computed(() => this.state().horizontalUsed);
        /** Scroll duration when the scroll track is clicked */
        this.trackScrollDuration = this.options.trackScrollDuration;
        /**
         *  Sets the appearance of the scrollbar, there are 2 options:
         *
         * - `native` (default) scrollbar space will be reserved just like with native scrollbar.
         * - `compact` scrollbar doesn't reserve any space, they are placed over the viewport.
         */
        this.appearance = this.options.appearance;
        /**
         * Sets the position of each scrollbar, there are 4 options:
         *
         * - `native` (Default) Use the default position like in native scrollbar.
         * - `invertY` Inverts vertical scrollbar position
         * - `invertX` Inverts Horizontal scrollbar position
         * - `invertAll` Inverts both scrollbar positions
         */
        this.position = this.options.position;
        /** A class forwarded to the scrollbar track element */
        this.trackClass = this.options.trackClass;
        /** A class forwarded to the scrollbar thumb element */
        this.thumbClass = this.options.thumbClass;
        /** A class forwarded to the scrollbar button element */
        this.buttonClass = this.options.thumbClass;
        /** Steam that emits when scrollbar is initialized */
        this.afterInit = new EventEmitter();
        /** Steam that emits when scrollbar is updated */
        this.afterUpdate = new EventEmitter();
        /** Viewport adapter instance */
        this.viewport = new ViewportAdapter();
    }
    ngOnInit() {
        runInInjectionContext(this.injector, () => {
            // The direction signal cannot be initialized in the constructor
            // Because it initially returns 'ltr' even if dir.value is 'rtl`, the map function here is crucial
            this.direction = toSignal(this.dir.change.pipe(map(() => this.dir.value)), { initialValue: this.dir.value });
            effect((onCleanup) => {
                // Check whether sensor should be enabled
                if (this.disableSensor()) {
                    // If sensor is disabled update manually
                    this.sizeChangeSub?.unsubscribe();
                }
                else {
                    if (this.platform.isBrowser && this.viewport.initialized()) {
                        this.sizeChangeSub?.unsubscribe();
                        this.zone.runOutsideAngular(() => {
                            this.sizeChangeSub = resizeObserver({
                                element: this.viewport.nativeElement,
                                contentWrapper: this.viewport.contentWrapperElement,
                                throttleDuration: this.sensorThrottleTime()
                            }).pipe(tap((reason) => this.update(reason))).subscribe();
                        });
                    }
                }
                onCleanup(() => this.sizeChangeSub?.unsubscribe());
            });
        });
    }
    ngAfterViewInit() {
        // If sensor is disabled, update to evaluate the state
        if (this.platform.isBrowser && this.disableSensor()) {
            // In case of 3rd party library, need to wait for content to be rendered
            requestAnimationFrame(() => {
                this.update(ScrollbarUpdateReason.AfterInit);
            });
        }
    }
    /**
     * Update local state and the internal scrollbar controls
     */
    update(reason) {
        this.updateCSSVariables();
        this.zone.run(() => {
            this.viewportDimension.set({
                contentHeight: this.viewport.contentHeight,
                contentWidth: this.viewport.contentWidth,
                offsetHeight: this.viewport.offsetHeight,
                offsetWidth: this.viewport.offsetWidth
            });
            // After the upgrade to Angular 18, the effect functions in the inner directives are executed after "afterInit" is emitted,
            // causing the tests to fail. A tiny delay is needed before emitting to the output as a workaround.
            if (reason === ScrollbarUpdateReason.AfterInit) {
                this.afterInit.emit();
            }
            else {
                this.afterUpdate.emit();
            }
        });
    }
    /**
     * Smooth scroll functions
     */
    scrollTo(options) {
        return this.smoothScroll.scrollTo(this.viewport.nativeElement, options);
    }
    /**
     * Scroll to element by reference or selector
     */
    scrollToElement(target, options) {
        return this.smoothScroll.scrollToElement(this.viewport.nativeElement, target, options);
    }
    /**
     * Update Essential CSS variables
     */
    updateCSSVariables() {
        this.nativeElement.style.setProperty('--content-height', `${this.viewport.contentHeight}`);
        this.nativeElement.style.setProperty('--content-width', `${this.viewport.contentWidth}`);
        this.nativeElement.style.setProperty('--viewport-height', `${this.viewport.offsetHeight}`);
        this.nativeElement.style.setProperty('--viewport-width', `${this.viewport.offsetWidth}`);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.2", ngImport: i0, type: NgScrollbarCore, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "17.1.0", version: "18.1.2", type: NgScrollbarCore, inputs: { orientation: { classPropertyName: "orientation", publicName: "orientation", isSignal: true, isRequired: false, transformFunction: null }, visibility: { classPropertyName: "visibility", publicName: "visibility", isSignal: true, isRequired: false, transformFunction: null }, buttons: { classPropertyName: "buttons", publicName: "buttons", isSignal: true, isRequired: false, transformFunction: null }, disableInteraction: { classPropertyName: "disableInteraction", publicName: "disableInteraction", isSignal: true, isRequired: false, transformFunction: null }, disableSensor: { classPropertyName: "disableSensor", publicName: "disableSensor", isSignal: true, isRequired: false, transformFunction: null }, sensorThrottleTime: { classPropertyName: "sensorThrottleTime", publicName: "sensorThrottleTime", isSignal: true, isRequired: false, transformFunction: null }, hoverOffset: { classPropertyName: "hoverOffset", publicName: "hoverOffset", isSignal: true, isRequired: false, transformFunction: null }, trackScrollDuration: { classPropertyName: "trackScrollDuration", publicName: "trackScrollDuration", isSignal: false, isRequired: false, transformFunction: numberAttribute }, appearance: { classPropertyName: "appearance", publicName: "appearance", isSignal: false, isRequired: false, transformFunction: null }, position: { classPropertyName: "position", publicName: "position", isSignal: false, isRequired: false, transformFunction: null }, trackClass: { classPropertyName: "trackClass", publicName: "trackClass", isSignal: false, isRequired: false, transformFunction: null }, thumbClass: { classPropertyName: "thumbClass", publicName: "thumbClass", isSignal: false, isRequired: false, transformFunction: null }, buttonClass: { classPropertyName: "buttonClass", publicName: "buttonClass", isSignal: false, isRequired: false, transformFunction: null } }, outputs: { afterInit: "afterInit", afterUpdate: "afterUpdate" }, host: { properties: { "class.ng-scrollbar": "true", "attr.verticalUsed": "verticalUsed()", "attr.horizontalUsed": "horizontalUsed()", "attr.isVerticallyScrollable": "isVerticallyScrollable()", "attr.isHorizontallyScrollable": "isHorizontallyScrollable()", "attr.mobile": "isMobile", "attr.dir": "direction()", "attr.position": "position", "attr.dragging": "dragging()", "attr.appearance": "appearance", "attr.visibility": "visibility()", "attr.orientation": "orientation()", "attr.disableInteraction": "disableInteraction()" } }, providers: [{ provide: NG_SCROLLBAR, useExisting: NgScrollbarCore }], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.2", ngImport: i0, type: NgScrollbarCore, decorators: [{
            type: Directive,
            args: [{
                    host: {
                        '[class.ng-scrollbar]': 'true',
                        '[attr.verticalUsed]': 'verticalUsed()',
                        '[attr.horizontalUsed]': 'horizontalUsed()',
                        '[attr.isVerticallyScrollable]': 'isVerticallyScrollable()',
                        '[attr.isHorizontallyScrollable]': 'isHorizontallyScrollable()',
                        '[attr.mobile]': 'isMobile',
                        '[attr.dir]': 'direction()',
                        '[attr.position]': 'position',
                        '[attr.dragging]': 'dragging()',
                        '[attr.appearance]': 'appearance',
                        '[attr.visibility]': 'visibility()',
                        '[attr.orientation]': 'orientation()',
                        '[attr.disableInteraction]': 'disableInteraction()'
                    },
                    providers: [{ provide: NG_SCROLLBAR, useExisting: NgScrollbarCore }]
                }]
        }], propDecorators: { trackScrollDuration: [{
                type: Input,
                args: [{ transform: numberAttribute }]
            }], appearance: [{
                type: Input
            }], position: [{
                type: Input
            }], trackClass: [{
                type: Input
            }], thumbClass: [{
                type: Input
            }], buttonClass: [{
                type: Input
            }], afterInit: [{
                type: Output
            }], afterUpdate: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLWNvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2Nyb2xsYmFyL3NyYy9saWIvbmctc2Nyb2xsYmFyLWNvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLE1BQU0sRUFDTixNQUFNLEVBQ04sTUFBTSxFQUNOLFFBQVEsRUFDUixlQUFlLEVBQ2YsZ0JBQWdCLEVBQ2hCLHFCQUFxQixFQUNyQixLQUFLLEVBQ0wsWUFBWSxFQUdaLFVBQVUsRUFDVixNQUFNLEVBR04sUUFBUSxFQUlULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQWEsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3RELE9BQU8sRUFBZ0IsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5QyxPQUFPLEVBRUwsbUJBQW1CLEVBR3BCLE1BQU0sNkJBQTZCLENBQUM7QUFFckMsT0FBTyxFQUFnQixZQUFZLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUU3RCxPQUFPLEVBSUwscUJBQXFCLEVBR3JCLG9CQUFvQixFQUNyQixNQUFNLHNCQUFzQixDQUFDOztBQUU5QixNQUFNLGNBQWMsR0FBdUI7SUFDekMsVUFBVSxFQUFFLEVBQUU7SUFDZCxVQUFVLEVBQUUsRUFBRTtJQUNkLFdBQVcsRUFBRSxFQUFFO0lBQ2YsV0FBVyxFQUFFLE1BQU07SUFDbkIsVUFBVSxFQUFFLFFBQVE7SUFDcEIsVUFBVSxFQUFFLFFBQVE7SUFDcEIsUUFBUSxFQUFFLFFBQVE7SUFDbEIsbUJBQW1CLEVBQUUsRUFBRTtJQUN2QixrQkFBa0IsRUFBRSxDQUFDO0lBQ3JCLGFBQWEsRUFBRSxLQUFLO0lBQ3BCLGtCQUFrQixFQUFFLEtBQUs7SUFDekIsT0FBTyxFQUFFLEtBQUs7SUFDZCxXQUFXLEVBQUUsS0FBSztDQUNuQixDQUFDO0FBMkJGLE1BQU0sT0FBZ0IsZUFBZTtJQWxCckM7UUFvQkUsdUJBQXVCO1FBQ04sb0JBQWUsR0FBdUIsTUFBTSxDQUFDLG9CQUFvQixFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFFeEcsbURBQW1EO1FBQ2xDLFlBQU8sR0FBdUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDO1FBRXJILFNBQUksR0FBVyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUIsYUFBUSxHQUFhLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0QyxhQUFRLEdBQWEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXZELHNEQUFzRDtRQUM3QyxhQUFRLEdBQVksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7UUFDeEUsUUFBRyxHQUFtQixNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFN0MsaUJBQVksR0FBd0IsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFFaEUsa0JBQWEsR0FBZ0IsTUFBTSxDQUFDLENBQUEsVUFBdUIsQ0FBQSxDQUFDLENBQUMsYUFBYSxDQUFDO1FBTzNFOztXQUVHO1FBQ0gsYUFBUSxHQUFzQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFN0Q7Ozs7OztXQU1HO1FBQ0gsZ0JBQVcsR0FBc0MsS0FBSyxDQUF1QixJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXZHOzs7Ozs7V0FNRztRQUNILGVBQVUsR0FBcUMsS0FBSyxDQUFzQixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRW5HLDZCQUE2QjtRQUM3QixZQUFPLEdBQXdELEtBQUssQ0FBNEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUU7WUFDcEgsU0FBUyxFQUFFLGdCQUFnQjtTQUM1QixDQUFDLENBQUM7UUFFSCxvRkFBb0Y7UUFDcEYsdUJBQWtCLEdBQXdELEtBQUssQ0FBNEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsRUFBRTtZQUMxSSxTQUFTLEVBQUUsZ0JBQWdCO1NBQzVCLENBQUMsQ0FBQztRQUVILHlDQUF5QztRQUN6QyxrQkFBYSxHQUF3RCxLQUFLLENBQTRCLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFO1lBQ2hJLFNBQVMsRUFBRSxnQkFBZ0I7U0FDNUIsQ0FBQyxDQUFDO1FBRUgsaUVBQWlFO1FBQ2pFLHVCQUFrQixHQUF3QixLQUFLLENBQWlCLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLEVBQUU7WUFDL0YsU0FBUyxFQUFFLGVBQWU7U0FDM0IsQ0FBQyxDQUFDO1FBRUgsbUZBQW1GO1FBQ25GLGdCQUFXLEdBQXdELEtBQUssQ0FBNEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUU7WUFDNUgsU0FBUyxFQUFFLGdCQUFnQjtTQUM1QixDQUFDLENBQUM7UUFFSCxzQkFBaUIsR0FBdUMsTUFBTSxDQUFDO1lBQzdELGFBQWEsRUFBRSxDQUFDO1lBQ2hCLFlBQVksRUFBRSxDQUFDO1lBQ2YsWUFBWSxFQUFFLENBQUM7WUFDZixXQUFXLEVBQUUsQ0FBQztTQUNmLENBQUMsQ0FBQztRQUVILFVBQUssR0FBMEIsUUFBUSxDQUFDLEdBQUcsRUFBRTtZQUMzQyxJQUFJLFlBQVksR0FBWSxLQUFLLENBQUM7WUFDbEMsSUFBSSxjQUFjLEdBQVksS0FBSyxDQUFDO1lBQ3BDLElBQUksc0JBQXNCLEdBQVksS0FBSyxDQUFDO1lBQzVDLElBQUksd0JBQXdCLEdBQVksS0FBSyxDQUFDO1lBRTlDLE1BQU0sV0FBVyxHQUF5QixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0QsTUFBTSxVQUFVLEdBQXdCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUMxRCxNQUFNLFFBQVEsR0FBdUIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFFOUQsa0RBQWtEO1lBQ2xELElBQUksV0FBVyxLQUFLLE1BQU0sSUFBSSxXQUFXLEtBQUssVUFBVSxFQUFFLENBQUM7Z0JBQ3pELHNCQUFzQixHQUFHLFFBQVEsQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQztnQkFDeEUsWUFBWSxHQUFHLFVBQVUsS0FBSyxTQUFTLElBQUksc0JBQXNCLENBQUM7WUFDcEUsQ0FBQztZQUNELG9EQUFvRDtZQUNwRCxJQUFJLFdBQVcsS0FBSyxNQUFNLElBQUksV0FBVyxLQUFLLFlBQVksRUFBRSxDQUFDO2dCQUMzRCx3QkFBd0IsR0FBRyxRQUFRLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUM7Z0JBQ3hFLGNBQWMsR0FBRyxVQUFVLEtBQUssU0FBUyxJQUFJLHdCQUF3QixDQUFDO1lBQ3hFLENBQUM7WUFFRCxPQUFPO2dCQUNMLFlBQVk7Z0JBQ1osY0FBYztnQkFDZCxzQkFBc0I7Z0JBQ3RCLHdCQUF3QjthQUN6QixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCwyQkFBc0IsR0FBb0IsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQzlGLDZCQUF3QixHQUFvQixRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDbEcsaUJBQVksR0FBb0IsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMxRSxtQkFBYyxHQUFvQixRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRTlFLHVEQUF1RDtRQUNoQix3QkFBbUIsR0FBVyxJQUFJLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDO1FBRXRHOzs7OztXQUtHO1FBQ00sZUFBVSxHQUF3QixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztRQUNuRTs7Ozs7OztXQU9HO1FBQ00sYUFBUSxHQUFzQixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztRQUU3RCx1REFBdUQ7UUFDOUMsZUFBVSxHQUFXLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO1FBQ3RELHVEQUF1RDtRQUM5QyxlQUFVLEdBQVcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDdEQsd0RBQXdEO1FBQy9DLGdCQUFXLEdBQVcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFFdkQscURBQXFEO1FBQzNDLGNBQVMsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUVuRSxpREFBaUQ7UUFDdkMsZ0JBQVcsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUtyRSxnQ0FBZ0M7UUFDaEMsYUFBUSxHQUFvQixJQUFJLGVBQWUsRUFBRSxDQUFDO0tBOEZuRDtJQXpGQyxRQUFRO1FBQ04scUJBQXFCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7WUFDeEMsZ0VBQWdFO1lBQ2hFLGtHQUFrRztZQUNsRyxJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBdUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBRW5JLE1BQU0sQ0FBQyxDQUFDLFNBQWtDLEVBQUUsRUFBRTtnQkFDNUMseUNBQXlDO2dCQUN6QyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDO29CQUN6Qix3Q0FBd0M7b0JBQ3hDLElBQUksQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLENBQUM7Z0JBQ3BDLENBQUM7cUJBQU0sQ0FBQztvQkFDTixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQzt3QkFDM0QsSUFBSSxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsQ0FBQzt3QkFFbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7NEJBQy9CLElBQUksQ0FBQyxhQUFhLEdBQUcsY0FBYyxDQUFDO2dDQUNsQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhO2dDQUNwQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUI7Z0NBQ25ELGdCQUFnQixFQUFFLElBQUksQ0FBQyxrQkFBa0IsRUFBRTs2QkFDNUMsQ0FBQyxDQUFDLElBQUksQ0FDTCxHQUFHLENBQUMsQ0FBQyxNQUE2QixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQzVELENBQUMsU0FBUyxFQUFFLENBQUM7d0JBQ2hCLENBQUMsQ0FBQyxDQUFDO29CQUNMLENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBQ3JELENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsZUFBZTtRQUNiLHNEQUFzRDtRQUN0RCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDO1lBQ3BELHdFQUF3RTtZQUN4RSxxQkFBcUIsQ0FBQyxHQUFHLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDL0MsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE1BQThCO1FBQ25DLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBRTFCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUNqQixJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDO2dCQUN6QixhQUFhLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhO2dCQUMxQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZO2dCQUN4QyxZQUFZLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZO2dCQUN4QyxXQUFXLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXO2FBQ3ZDLENBQUMsQ0FBQztZQUVILDJIQUEySDtZQUMzSCxtR0FBbUc7WUFDbkcsSUFBSSxNQUFNLEtBQUsscUJBQXFCLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQy9DLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDeEIsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDMUIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0gsUUFBUSxDQUFDLE9BQThCO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVMsQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0UsQ0FBQztJQUVEOztPQUVHO0lBQ0gsZUFBZSxDQUFDLE1BQTJCLEVBQUUsT0FBc0M7UUFDakYsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDekYsQ0FBQztJQUVEOztPQUVHO0lBQ0ssa0JBQWtCO1FBQ3hCLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxHQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYyxFQUFFLENBQUMsQ0FBQztRQUM3RixJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsaUJBQWlCLEVBQUUsR0FBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQWEsRUFBRSxDQUFDLENBQUM7UUFDM0YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLG1CQUFtQixFQUFFLEdBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQzdGLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxHQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBWSxFQUFFLENBQUMsQ0FBQztJQUM3RixDQUFDOzhHQXBQbUIsZUFBZTtrR0FBZixlQUFlLDhvQ0FtSGYsZUFBZSx5d0NBckh4QixDQUFDLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLENBQUM7OzJGQUVoRCxlQUFlO2tCQWxCcEMsU0FBUzttQkFBQztvQkFDVCxJQUFJLEVBQUU7d0JBQ0osc0JBQXNCLEVBQUUsTUFBTTt3QkFDOUIscUJBQXFCLEVBQUUsZ0JBQWdCO3dCQUN2Qyx1QkFBdUIsRUFBRSxrQkFBa0I7d0JBQzNDLCtCQUErQixFQUFFLDBCQUEwQjt3QkFDM0QsaUNBQWlDLEVBQUUsNEJBQTRCO3dCQUMvRCxlQUFlLEVBQUUsVUFBVTt3QkFDM0IsWUFBWSxFQUFFLGFBQWE7d0JBQzNCLGlCQUFpQixFQUFFLFVBQVU7d0JBQzdCLGlCQUFpQixFQUFFLFlBQVk7d0JBQy9CLG1CQUFtQixFQUFFLFlBQVk7d0JBQ2pDLG1CQUFtQixFQUFFLGNBQWM7d0JBQ25DLG9CQUFvQixFQUFFLGVBQWU7d0JBQ3JDLDJCQUEyQixFQUFFLHNCQUFzQjtxQkFDcEQ7b0JBQ0QsU0FBUyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsaUJBQWlCLEVBQUUsQ0FBQztpQkFDckU7OEJBb0h3QyxtQkFBbUI7c0JBQXpELEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFO2dCQVE1QixVQUFVO3NCQUFsQixLQUFLO2dCQVNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBR0csVUFBVTtzQkFBbEIsS0FBSztnQkFFRyxVQUFVO3NCQUFsQixLQUFLO2dCQUVHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBR0ksU0FBUztzQkFBbEIsTUFBTTtnQkFHRyxXQUFXO3NCQUFwQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIGluamVjdCxcclxuICBzaWduYWwsXHJcbiAgZWZmZWN0LFxyXG4gIGNvbXB1dGVkLFxyXG4gIG51bWJlckF0dHJpYnV0ZSxcclxuICBib29sZWFuQXR0cmlidXRlLFxyXG4gIHJ1bkluSW5qZWN0aW9uQ29udGV4dCxcclxuICBpbnB1dCxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgT25Jbml0LFxyXG4gIEFmdGVyVmlld0luaXQsXHJcbiAgRWxlbWVudFJlZixcclxuICBOZ1pvbmUsXHJcbiAgU2lnbmFsLFxyXG4gIElucHV0U2lnbmFsLFxyXG4gIEluamVjdG9yLFxyXG4gIFdyaXRhYmxlU2lnbmFsLFxyXG4gIEVmZmVjdENsZWFudXBSZWdpc3RlckZuLFxyXG4gIElucHV0U2lnbmFsV2l0aFRyYW5zZm9ybVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQbGF0Zm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wbGF0Zm9ybSc7XHJcbmltcG9ydCB7IERpcmVjdGlvbiwgRGlyZWN0aW9uYWxpdHkgfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XHJcbmltcG9ydCB7IHRvU2lnbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24sIG1hcCwgdGFwIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7XHJcbiAgU21vb3RoU2Nyb2xsRWxlbWVudCxcclxuICBTbW9vdGhTY3JvbGxNYW5hZ2VyLFxyXG4gIFNtb290aFNjcm9sbFRvRWxlbWVudE9wdGlvbnMsXHJcbiAgU21vb3RoU2Nyb2xsVG9PcHRpb25zXHJcbn0gZnJvbSAnbmd4LXNjcm9sbGJhci9zbW9vdGgtc2Nyb2xsJztcclxuaW1wb3J0IHsgU2Nyb2xsYmFycyB9IGZyb20gJy4vc2Nyb2xsYmFycy9zY3JvbGxiYXJzJztcclxuaW1wb3J0IHsgX05nU2Nyb2xsYmFyLCBOR19TQ1JPTExCQVIgfSBmcm9tICcuL3V0aWxzL3Njcm9sbGJhci1iYXNlJztcclxuaW1wb3J0IHsgcmVzaXplT2JzZXJ2ZXIsIFZpZXdwb3J0QWRhcHRlciB9IGZyb20gJy4vdmlld3BvcnQnO1xyXG5pbXBvcnQgeyBTY3JvbGxiYXJEcmFnZ2luZywgVmlld3BvcnRCb3VuZGFyaWVzIH0gZnJvbSAnLi91dGlscy9jb21tb24nO1xyXG5pbXBvcnQge1xyXG4gIFNjcm9sbGJhckFwcGVhcmFuY2UsXHJcbiAgU2Nyb2xsYmFyUG9zaXRpb24sXHJcbiAgU2Nyb2xsYmFyT3JpZW50YXRpb24sXHJcbiAgU2Nyb2xsYmFyVXBkYXRlUmVhc29uLFxyXG4gIFNjcm9sbGJhclZpc2liaWxpdHksXHJcbiAgTmdTY3JvbGxiYXJPcHRpb25zLFxyXG4gIE5HX1NDUk9MTEJBUl9PUFRJT05TXHJcbn0gZnJvbSAnLi9uZy1zY3JvbGxiYXIubW9kZWwnO1xyXG5cclxuY29uc3QgZGVmYXVsdE9wdGlvbnM6IE5nU2Nyb2xsYmFyT3B0aW9ucyA9IHtcclxuICB0cmFja0NsYXNzOiAnJyxcclxuICB0aHVtYkNsYXNzOiAnJyxcclxuICBidXR0b25DbGFzczogJycsXHJcbiAgb3JpZW50YXRpb246ICdhdXRvJyxcclxuICBhcHBlYXJhbmNlOiAnbmF0aXZlJyxcclxuICB2aXNpYmlsaXR5OiAnbmF0aXZlJyxcclxuICBwb3NpdGlvbjogJ25hdGl2ZScsXHJcbiAgdHJhY2tTY3JvbGxEdXJhdGlvbjogNTAsXHJcbiAgc2Vuc29yVGhyb3R0bGVUaW1lOiAwLFxyXG4gIGRpc2FibGVTZW5zb3I6IGZhbHNlLFxyXG4gIGRpc2FibGVJbnRlcmFjdGlvbjogZmFsc2UsXHJcbiAgYnV0dG9uczogZmFsc2UsXHJcbiAgaG92ZXJPZmZzZXQ6IGZhbHNlXHJcbn07XHJcblxyXG5pbnRlcmZhY2UgVmlld3BvcnRTdGF0ZSB7XHJcbiAgdmVydGljYWxVc2VkOiBib29sZWFuLFxyXG4gIGhvcml6b250YWxVc2VkOiBib29sZWFuLFxyXG4gIGlzVmVydGljYWxseVNjcm9sbGFibGU6IGJvb2xlYW4sXHJcbiAgaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlOiBib29sZWFuLFxyXG59XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBob3N0OiB7XHJcbiAgICAnW2NsYXNzLm5nLXNjcm9sbGJhcl0nOiAndHJ1ZScsXHJcbiAgICAnW2F0dHIudmVydGljYWxVc2VkXSc6ICd2ZXJ0aWNhbFVzZWQoKScsXHJcbiAgICAnW2F0dHIuaG9yaXpvbnRhbFVzZWRdJzogJ2hvcml6b250YWxVc2VkKCknLFxyXG4gICAgJ1thdHRyLmlzVmVydGljYWxseVNjcm9sbGFibGVdJzogJ2lzVmVydGljYWxseVNjcm9sbGFibGUoKScsXHJcbiAgICAnW2F0dHIuaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlXSc6ICdpc0hvcml6b250YWxseVNjcm9sbGFibGUoKScsXHJcbiAgICAnW2F0dHIubW9iaWxlXSc6ICdpc01vYmlsZScsXHJcbiAgICAnW2F0dHIuZGlyXSc6ICdkaXJlY3Rpb24oKScsXHJcbiAgICAnW2F0dHIucG9zaXRpb25dJzogJ3Bvc2l0aW9uJyxcclxuICAgICdbYXR0ci5kcmFnZ2luZ10nOiAnZHJhZ2dpbmcoKScsXHJcbiAgICAnW2F0dHIuYXBwZWFyYW5jZV0nOiAnYXBwZWFyYW5jZScsXHJcbiAgICAnW2F0dHIudmlzaWJpbGl0eV0nOiAndmlzaWJpbGl0eSgpJyxcclxuICAgICdbYXR0ci5vcmllbnRhdGlvbl0nOiAnb3JpZW50YXRpb24oKScsXHJcbiAgICAnW2F0dHIuZGlzYWJsZUludGVyYWN0aW9uXSc6ICdkaXNhYmxlSW50ZXJhY3Rpb24oKSdcclxuICB9LFxyXG4gIHByb3ZpZGVyczogW3sgcHJvdmlkZTogTkdfU0NST0xMQkFSLCB1c2VFeGlzdGluZzogTmdTY3JvbGxiYXJDb3JlIH1dXHJcbn0pXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBOZ1Njcm9sbGJhckNvcmUgaW1wbGVtZW50cyBfTmdTY3JvbGxiYXIsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gIC8qKiBJbmplY3RlZCBvcHRpb25zICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBpbmplY3RlZE9wdGlvbnM6IE5nU2Nyb2xsYmFyT3B0aW9ucyA9IGluamVjdChOR19TQ1JPTExCQVJfT1BUSU9OUywgeyBvcHRpb25hbDogdHJ1ZSB9KTtcclxuXHJcbiAgLyoqIENvbWJpbmUgaW5qZWN0ZWQgb3B0aW9uIHdpdGggZGVmYXVsdCBvcHRpb25zICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBOZ1Njcm9sbGJhck9wdGlvbnMgPSB0aGlzLmluamVjdGVkT3B0aW9ucyA/IHsgLi4uZGVmYXVsdE9wdGlvbnMsIC4uLnRoaXMuaW5qZWN0ZWRPcHRpb25zIH0gOiBkZWZhdWx0T3B0aW9ucztcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSB6b25lOiBOZ1pvbmUgPSBpbmplY3QoTmdab25lKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHBsYXRmb3JtOiBQbGF0Zm9ybSA9IGluamVjdChQbGF0Zm9ybSk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBpbmplY3RvcjogSW5qZWN0b3IgPSBpbmplY3QoSW5qZWN0b3IpO1xyXG5cclxuICAvKiogQSBmbGFnIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBwbGF0Zm9ybSBpcyBtb2JpbGUgKi9cclxuICByZWFkb25seSBpc01vYmlsZTogYm9vbGVhbiA9IHRoaXMucGxhdGZvcm0uSU9TIHx8IHRoaXMucGxhdGZvcm0uQU5EUk9JRDtcclxuICBkaXI6IERpcmVjdGlvbmFsaXR5ID0gaW5qZWN0KERpcmVjdGlvbmFsaXR5KTtcclxuXHJcbiAgc21vb3RoU2Nyb2xsOiBTbW9vdGhTY3JvbGxNYW5hZ2VyID0gaW5qZWN0KFNtb290aFNjcm9sbE1hbmFnZXIpO1xyXG5cclxuICBuYXRpdmVFbGVtZW50OiBIVE1MRWxlbWVudCA9IGluamVjdChFbGVtZW50UmVmPEhUTUxFbGVtZW50PikubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIGlmIHRoZSBkaXJlY3Rpb24gaXMgJ2x0cicgb3IgJ3J0bCdcclxuICAgKi9cclxuICBkaXJlY3Rpb246IFNpZ25hbDxEaXJlY3Rpb24+O1xyXG5cclxuICAvKipcclxuICAgKiBJbmRpY2F0ZXMgd2hlbiBzY3JvbGxiYXIgdGh1bWIgaXMgYmVpbmcgZHJhZ2dlZFxyXG4gICAqL1xyXG4gIGRyYWdnaW5nOiBXcml0YWJsZVNpZ25hbDxTY3JvbGxiYXJEcmFnZ2luZz4gPSBzaWduYWwoJ25vbmUnKTtcclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgc3VwcG9ydGVkIHNjcm9sbCB0cmFjayBvZiB0aGUgdmlld3BvcnQsIHRoZXJlIGFyZSAzIG9wdGlvbnM6XHJcbiAgICpcclxuICAgKiAtIGB2ZXJ0aWNhbGAgVXNlIGJvdGggdmVydGljYWwgYW5kIGhvcml6b250YWwgc2Nyb2xsYmFyXHJcbiAgICogLSBgaG9yaXpvbnRhbGAgVXNlIGJvdGggdmVydGljYWwgYW5kIGhvcml6b250YWwgc2Nyb2xsYmFyXHJcbiAgICogLSBgYXV0b2AgVXNlIGJvdGggdmVydGljYWwgYW5kIGhvcml6b250YWwgc2Nyb2xsYmFyXHJcbiAgICovXHJcbiAgb3JpZW50YXRpb246IElucHV0U2lnbmFsPFNjcm9sbGJhck9yaWVudGF0aW9uPiA9IGlucHV0PFNjcm9sbGJhck9yaWVudGF0aW9uPih0aGlzLm9wdGlvbnMub3JpZW50YXRpb24pO1xyXG5cclxuICAvKipcclxuICAgKiBXaGVuIHRvIHNob3cgdGhlIHNjcm9sbGJhciwgYW5kIHRoZXJlIGFyZSAzIG9wdGlvbnM6XHJcbiAgICpcclxuICAgKiAtIGBuYXRpdmVgIChkZWZhdWx0KSBTY3JvbGxiYXIgd2lsbCBiZSB2aXNpYmxlIHdoZW4gdmlld3BvcnQgaXMgc2Nyb2xsYWJsZSBsaWtlIHdpdGggbmF0aXZlIHNjcm9sbGJhclxyXG4gICAqIC0gYGhvdmVyYCBTY3JvbGxiYXJzIGFyZSBoaWRkZW4gYnkgZGVmYXVsdCwgb25seSB2aXNpYmxlIG9uIHNjcm9sbGluZyBvciBob3ZlcmluZ1xyXG4gICAqIC0gYGFsd2F5c2AgU2Nyb2xsYmFycyBhcmUgYWx3YXlzIHNob3duIGV2ZW4gaWYgdGhlIHZpZXdwb3J0IGlzIG5vdCBzY3JvbGxhYmxlXHJcbiAgICovXHJcbiAgdmlzaWJpbGl0eTogSW5wdXRTaWduYWw8U2Nyb2xsYmFyVmlzaWJpbGl0eT4gPSBpbnB1dDxTY3JvbGxiYXJWaXNpYmlsaXR5Pih0aGlzLm9wdGlvbnMudmlzaWJpbGl0eSk7XHJcblxyXG4gIC8qKiBTaG93IHNjcm9sbGJhciBidXR0b25zICovXHJcbiAgYnV0dG9uczogSW5wdXRTaWduYWxXaXRoVHJhbnNmb3JtPGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+ID0gaW5wdXQ8Ym9vbGVhbiwgc3RyaW5nIHwgYm9vbGVhbj4odGhpcy5vcHRpb25zLmJ1dHRvbnMsIHtcclxuICAgIHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZVxyXG4gIH0pO1xyXG5cclxuICAvKiogRGlzYWJsZXMgc2Nyb2xsYmFyIGludGVyYWN0aW9uIGxpa2UgZHJhZ2dpbmcgdGh1bWIgYW5kIGp1bXBpbmcgYnkgdHJhY2sgY2xpY2sgKi9cclxuICBkaXNhYmxlSW50ZXJhY3Rpb246IElucHV0U2lnbmFsV2l0aFRyYW5zZm9ybTxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPiA9IGlucHV0PGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+KHRoaXMub3B0aW9ucy5kaXNhYmxlSW50ZXJhY3Rpb24sIHtcclxuICAgIHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZVxyXG4gIH0pO1xyXG5cclxuICAvKiogV2hldGhlciBSZXNpemVPYnNlcnZlciBpcyBkaXNhYmxlZCAqL1xyXG4gIGRpc2FibGVTZW5zb3I6IElucHV0U2lnbmFsV2l0aFRyYW5zZm9ybTxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPiA9IGlucHV0PGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+KHRoaXMub3B0aW9ucy5kaXNhYmxlU2Vuc29yLCB7XHJcbiAgICB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGVcclxuICB9KTtcclxuXHJcbiAgLyoqIFRocm90dGxlIGludGVydmFsIGZvciBkZXRlY3RpbmcgY2hhbmdlcyB2aWEgUmVzaXplT2JzZXJ2ZXIgKi9cclxuICBzZW5zb3JUaHJvdHRsZVRpbWU6IElucHV0U2lnbmFsPG51bWJlcj4gPSBpbnB1dDxudW1iZXIsIG51bWJlcj4odGhpcy5vcHRpb25zLnNlbnNvclRocm90dGxlVGltZSwge1xyXG4gICAgdHJhbnNmb3JtOiBudW1iZXJBdHRyaWJ1dGVcclxuICB9KTtcclxuXHJcbiAgLyoqIEEgZmxhZyB1c2VkIHRvIGFjdGl2YXRlIGhvdmVyIGVmZmVjdCBvbiB0aGUgb2Zmc2V0IGFyZWEgYXJvdW5kIHRoZSBzY3JvbGxiYXIgKi9cclxuICBob3Zlck9mZnNldDogSW5wdXRTaWduYWxXaXRoVHJhbnNmb3JtPGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+ID0gaW5wdXQ8Ym9vbGVhbiwgc3RyaW5nIHwgYm9vbGVhbj4odGhpcy5vcHRpb25zLmhvdmVyT2Zmc2V0LCB7XHJcbiAgICB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGVcclxuICB9KTtcclxuXHJcbiAgdmlld3BvcnREaW1lbnNpb246IFdyaXRhYmxlU2lnbmFsPFZpZXdwb3J0Qm91bmRhcmllcz4gPSBzaWduYWwoe1xyXG4gICAgY29udGVudEhlaWdodDogMCxcclxuICAgIGNvbnRlbnRXaWR0aDogMCxcclxuICAgIG9mZnNldEhlaWdodDogMCxcclxuICAgIG9mZnNldFdpZHRoOiAwXHJcbiAgfSk7XHJcblxyXG4gIHN0YXRlOiBTaWduYWw8Vmlld3BvcnRTdGF0ZT4gPSBjb21wdXRlZCgoKSA9PiB7XHJcbiAgICBsZXQgdmVydGljYWxVc2VkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBsZXQgaG9yaXpvbnRhbFVzZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGxldCBpc1ZlcnRpY2FsbHlTY3JvbGxhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBsZXQgaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3Qgb3JpZW50YXRpb246IFNjcm9sbGJhck9yaWVudGF0aW9uID0gdGhpcy5vcmllbnRhdGlvbigpO1xyXG4gICAgY29uc3QgdmlzaWJpbGl0eTogU2Nyb2xsYmFyVmlzaWJpbGl0eSA9IHRoaXMudmlzaWJpbGl0eSgpO1xyXG4gICAgY29uc3Qgdmlld3BvcnQ6IFZpZXdwb3J0Qm91bmRhcmllcyA9IHRoaXMudmlld3BvcnREaW1lbnNpb24oKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiB2ZXJ0aWNhbCBzY3JvbGxiYXIgc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSAnYXV0bycgfHwgb3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcpIHtcclxuICAgICAgaXNWZXJ0aWNhbGx5U2Nyb2xsYWJsZSA9IHZpZXdwb3J0LmNvbnRlbnRIZWlnaHQgPiB2aWV3cG9ydC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgIHZlcnRpY2FsVXNlZCA9IHZpc2liaWxpdHkgPT09ICd2aXNpYmxlJyB8fCBpc1ZlcnRpY2FsbHlTY3JvbGxhYmxlO1xyXG4gICAgfVxyXG4gICAgLy8gQ2hlY2sgaWYgaG9yaXpvbnRhbCBzY3JvbGxiYXIgc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSAnYXV0bycgfHwgb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJykge1xyXG4gICAgICBpc0hvcml6b250YWxseVNjcm9sbGFibGUgPSB2aWV3cG9ydC5jb250ZW50V2lkdGggPiB2aWV3cG9ydC5vZmZzZXRXaWR0aDtcclxuICAgICAgaG9yaXpvbnRhbFVzZWQgPSB2aXNpYmlsaXR5ID09PSAndmlzaWJsZScgfHwgaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZlcnRpY2FsVXNlZCxcclxuICAgICAgaG9yaXpvbnRhbFVzZWQsXHJcbiAgICAgIGlzVmVydGljYWxseVNjcm9sbGFibGUsXHJcbiAgICAgIGlzSG9yaXpvbnRhbGx5U2Nyb2xsYWJsZSxcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGlzVmVydGljYWxseVNjcm9sbGFibGU6IFNpZ25hbDxib29sZWFuPiA9IGNvbXB1dGVkKCgpID0+IHRoaXMuc3RhdGUoKS5pc1ZlcnRpY2FsbHlTY3JvbGxhYmxlKTtcclxuICBpc0hvcml6b250YWxseVNjcm9sbGFibGU6IFNpZ25hbDxib29sZWFuPiA9IGNvbXB1dGVkKCgpID0+IHRoaXMuc3RhdGUoKS5pc0hvcml6b250YWxseVNjcm9sbGFibGUpO1xyXG4gIHZlcnRpY2FsVXNlZDogU2lnbmFsPGJvb2xlYW4+ID0gY29tcHV0ZWQoKCkgPT4gdGhpcy5zdGF0ZSgpLnZlcnRpY2FsVXNlZCk7XHJcbiAgaG9yaXpvbnRhbFVzZWQ6IFNpZ25hbDxib29sZWFuPiA9IGNvbXB1dGVkKCgpID0+IHRoaXMuc3RhdGUoKS5ob3Jpem9udGFsVXNlZCk7XHJcblxyXG4gIC8qKiBTY3JvbGwgZHVyYXRpb24gd2hlbiB0aGUgc2Nyb2xsIHRyYWNrIGlzIGNsaWNrZWQgKi9cclxuICBASW5wdXQoeyB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZSB9KSB0cmFja1Njcm9sbER1cmF0aW9uOiBudW1iZXIgPSB0aGlzLm9wdGlvbnMudHJhY2tTY3JvbGxEdXJhdGlvbjtcclxuXHJcbiAgLyoqXHJcbiAgICogIFNldHMgdGhlIGFwcGVhcmFuY2Ugb2YgdGhlIHNjcm9sbGJhciwgdGhlcmUgYXJlIDIgb3B0aW9uczpcclxuICAgKlxyXG4gICAqIC0gYG5hdGl2ZWAgKGRlZmF1bHQpIHNjcm9sbGJhciBzcGFjZSB3aWxsIGJlIHJlc2VydmVkIGp1c3QgbGlrZSB3aXRoIG5hdGl2ZSBzY3JvbGxiYXIuXHJcbiAgICogLSBgY29tcGFjdGAgc2Nyb2xsYmFyIGRvZXNuJ3QgcmVzZXJ2ZSBhbnkgc3BhY2UsIHRoZXkgYXJlIHBsYWNlZCBvdmVyIHRoZSB2aWV3cG9ydC5cclxuICAgKi9cclxuICBASW5wdXQoKSBhcHBlYXJhbmNlOiBTY3JvbGxiYXJBcHBlYXJhbmNlID0gdGhpcy5vcHRpb25zLmFwcGVhcmFuY2U7XHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgcG9zaXRpb24gb2YgZWFjaCBzY3JvbGxiYXIsIHRoZXJlIGFyZSA0IG9wdGlvbnM6XHJcbiAgICpcclxuICAgKiAtIGBuYXRpdmVgIChEZWZhdWx0KSBVc2UgdGhlIGRlZmF1bHQgcG9zaXRpb24gbGlrZSBpbiBuYXRpdmUgc2Nyb2xsYmFyLlxyXG4gICAqIC0gYGludmVydFlgIEludmVydHMgdmVydGljYWwgc2Nyb2xsYmFyIHBvc2l0aW9uXHJcbiAgICogLSBgaW52ZXJ0WGAgSW52ZXJ0cyBIb3Jpem9udGFsIHNjcm9sbGJhciBwb3NpdGlvblxyXG4gICAqIC0gYGludmVydEFsbGAgSW52ZXJ0cyBib3RoIHNjcm9sbGJhciBwb3NpdGlvbnNcclxuICAgKi9cclxuICBASW5wdXQoKSBwb3NpdGlvbjogU2Nyb2xsYmFyUG9zaXRpb24gPSB0aGlzLm9wdGlvbnMucG9zaXRpb247XHJcblxyXG4gIC8qKiBBIGNsYXNzIGZvcndhcmRlZCB0byB0aGUgc2Nyb2xsYmFyIHRyYWNrIGVsZW1lbnQgKi9cclxuICBASW5wdXQoKSB0cmFja0NsYXNzOiBzdHJpbmcgPSB0aGlzLm9wdGlvbnMudHJhY2tDbGFzcztcclxuICAvKiogQSBjbGFzcyBmb3J3YXJkZWQgdG8gdGhlIHNjcm9sbGJhciB0aHVtYiBlbGVtZW50ICovXHJcbiAgQElucHV0KCkgdGh1bWJDbGFzczogc3RyaW5nID0gdGhpcy5vcHRpb25zLnRodW1iQ2xhc3M7XHJcbiAgLyoqIEEgY2xhc3MgZm9yd2FyZGVkIHRvIHRoZSBzY3JvbGxiYXIgYnV0dG9uIGVsZW1lbnQgKi9cclxuICBASW5wdXQoKSBidXR0b25DbGFzczogc3RyaW5nID0gdGhpcy5vcHRpb25zLnRodW1iQ2xhc3M7XHJcblxyXG4gIC8qKiBTdGVhbSB0aGF0IGVtaXRzIHdoZW4gc2Nyb2xsYmFyIGlzIGluaXRpYWxpemVkICovXHJcbiAgQE91dHB1dCgpIGFmdGVySW5pdDogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICAvKiogU3RlYW0gdGhhdCBlbWl0cyB3aGVuIHNjcm9sbGJhciBpcyB1cGRhdGVkICovXHJcbiAgQE91dHB1dCgpIGFmdGVyVXBkYXRlOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcblxyXG4gIC8qKiBSZXNpemUgb2JzZXJ2ZXIgc3Vic2NyaXB0aW9uICovXHJcbiAgcHJpdmF0ZSBzaXplQ2hhbmdlU3ViOiBTdWJzY3JpcHRpb247XHJcblxyXG4gIC8qKiBWaWV3cG9ydCBhZGFwdGVyIGluc3RhbmNlICovXHJcbiAgdmlld3BvcnQ6IFZpZXdwb3J0QWRhcHRlciA9IG5ldyBWaWV3cG9ydEFkYXB0ZXIoKTtcclxuXHJcbiAgLyoqIFRoZSBzY3JvbGxiYXJzIGNvbXBvbmVudCBpbnN0YW5jZSB1c2VkIGZvciB0ZXN0aW5nIHB1cnBvc2UgKi9cclxuICBhYnN0cmFjdCBfc2Nyb2xsYmFyczogU2Nyb2xsYmFycztcclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICBydW5JbkluamVjdGlvbkNvbnRleHQodGhpcy5pbmplY3RvciwgKCkgPT4ge1xyXG4gICAgICAvLyBUaGUgZGlyZWN0aW9uIHNpZ25hbCBjYW5ub3QgYmUgaW5pdGlhbGl6ZWQgaW4gdGhlIGNvbnN0cnVjdG9yXHJcbiAgICAgIC8vIEJlY2F1c2UgaXQgaW5pdGlhbGx5IHJldHVybnMgJ2x0cicgZXZlbiBpZiBkaXIudmFsdWUgaXMgJ3J0bGAsIHRoZSBtYXAgZnVuY3Rpb24gaGVyZSBpcyBjcnVjaWFsXHJcbiAgICAgIHRoaXMuZGlyZWN0aW9uID0gdG9TaWduYWw8RGlyZWN0aW9uLCBEaXJlY3Rpb24+KHRoaXMuZGlyLmNoYW5nZS5waXBlKG1hcCgoKSA9PiB0aGlzLmRpci52YWx1ZSkpLCB7IGluaXRpYWxWYWx1ZTogdGhpcy5kaXIudmFsdWUgfSk7XHJcblxyXG4gICAgICBlZmZlY3QoKG9uQ2xlYW51cDogRWZmZWN0Q2xlYW51cFJlZ2lzdGVyRm4pID0+IHtcclxuICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHNlbnNvciBzaG91bGQgYmUgZW5hYmxlZFxyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVTZW5zb3IoKSkge1xyXG4gICAgICAgICAgLy8gSWYgc2Vuc29yIGlzIGRpc2FibGVkIHVwZGF0ZSBtYW51YWxseVxyXG4gICAgICAgICAgdGhpcy5zaXplQ2hhbmdlU3ViPy51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAodGhpcy5wbGF0Zm9ybS5pc0Jyb3dzZXIgJiYgdGhpcy52aWV3cG9ydC5pbml0aWFsaXplZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZUNoYW5nZVN1Yj8udW5zdWJzY3JpYmUoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zaXplQ2hhbmdlU3ViID0gcmVzaXplT2JzZXJ2ZXIoe1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudDogdGhpcy52aWV3cG9ydC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgY29udGVudFdyYXBwZXI6IHRoaXMudmlld3BvcnQuY29udGVudFdyYXBwZXJFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgdGhyb3R0bGVEdXJhdGlvbjogdGhpcy5zZW5zb3JUaHJvdHRsZVRpbWUoKVxyXG4gICAgICAgICAgICAgIH0pLnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YXAoKHJlYXNvbjogU2Nyb2xsYmFyVXBkYXRlUmVhc29uKSA9PiB0aGlzLnVwZGF0ZShyZWFzb24pKVxyXG4gICAgICAgICAgICAgICkuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb25DbGVhbnVwKCgpID0+IHRoaXMuc2l6ZUNoYW5nZVN1Yj8udW5zdWJzY3JpYmUoKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAvLyBJZiBzZW5zb3IgaXMgZGlzYWJsZWQsIHVwZGF0ZSB0byBldmFsdWF0ZSB0aGUgc3RhdGVcclxuICAgIGlmICh0aGlzLnBsYXRmb3JtLmlzQnJvd3NlciAmJiB0aGlzLmRpc2FibGVTZW5zb3IoKSkge1xyXG4gICAgICAvLyBJbiBjYXNlIG9mIDNyZCBwYXJ0eSBsaWJyYXJ5LCBuZWVkIHRvIHdhaXQgZm9yIGNvbnRlbnQgdG8gYmUgcmVuZGVyZWRcclxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZShTY3JvbGxiYXJVcGRhdGVSZWFzb24uQWZ0ZXJJbml0KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgbG9jYWwgc3RhdGUgYW5kIHRoZSBpbnRlcm5hbCBzY3JvbGxiYXIgY29udHJvbHNcclxuICAgKi9cclxuICB1cGRhdGUocmVhc29uPzogU2Nyb2xsYmFyVXBkYXRlUmVhc29uKTogdm9pZCB7XHJcbiAgICB0aGlzLnVwZGF0ZUNTU1ZhcmlhYmxlcygpO1xyXG5cclxuICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICB0aGlzLnZpZXdwb3J0RGltZW5zaW9uLnNldCh7XHJcbiAgICAgICAgY29udGVudEhlaWdodDogdGhpcy52aWV3cG9ydC5jb250ZW50SGVpZ2h0LFxyXG4gICAgICAgIGNvbnRlbnRXaWR0aDogdGhpcy52aWV3cG9ydC5jb250ZW50V2lkdGgsXHJcbiAgICAgICAgb2Zmc2V0SGVpZ2h0OiB0aGlzLnZpZXdwb3J0Lm9mZnNldEhlaWdodCxcclxuICAgICAgICBvZmZzZXRXaWR0aDogdGhpcy52aWV3cG9ydC5vZmZzZXRXaWR0aFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFmdGVyIHRoZSB1cGdyYWRlIHRvIEFuZ3VsYXIgMTgsIHRoZSBlZmZlY3QgZnVuY3Rpb25zIGluIHRoZSBpbm5lciBkaXJlY3RpdmVzIGFyZSBleGVjdXRlZCBhZnRlciBcImFmdGVySW5pdFwiIGlzIGVtaXR0ZWQsXHJcbiAgICAgIC8vIGNhdXNpbmcgdGhlIHRlc3RzIHRvIGZhaWwuIEEgdGlueSBkZWxheSBpcyBuZWVkZWQgYmVmb3JlIGVtaXR0aW5nIHRvIHRoZSBvdXRwdXQgYXMgYSB3b3JrYXJvdW5kLlxyXG4gICAgICBpZiAocmVhc29uID09PSBTY3JvbGxiYXJVcGRhdGVSZWFzb24uQWZ0ZXJJbml0KSB7XHJcbiAgICAgICAgdGhpcy5hZnRlckluaXQuZW1pdCgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYWZ0ZXJVcGRhdGUuZW1pdCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNtb290aCBzY3JvbGwgZnVuY3Rpb25zXHJcbiAgICovXHJcbiAgc2Nyb2xsVG8ob3B0aW9uczogU21vb3RoU2Nyb2xsVG9PcHRpb25zKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zbW9vdGhTY3JvbGwuc2Nyb2xsVG8odGhpcy52aWV3cG9ydCEubmF0aXZlRWxlbWVudCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTY3JvbGwgdG8gZWxlbWVudCBieSByZWZlcmVuY2Ugb3Igc2VsZWN0b3JcclxuICAgKi9cclxuICBzY3JvbGxUb0VsZW1lbnQodGFyZ2V0OiBTbW9vdGhTY3JvbGxFbGVtZW50LCBvcHRpb25zPzogU21vb3RoU2Nyb2xsVG9FbGVtZW50T3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc21vb3RoU2Nyb2xsLnNjcm9sbFRvRWxlbWVudCh0aGlzLnZpZXdwb3J0Lm5hdGl2ZUVsZW1lbnQsIHRhcmdldCwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgRXNzZW50aWFsIENTUyB2YXJpYWJsZXNcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZUNTU1ZhcmlhYmxlcygpOiB2b2lkIHtcclxuICAgIHRoaXMubmF0aXZlRWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1jb250ZW50LWhlaWdodCcsIGAkeyB0aGlzLnZpZXdwb3J0LmNvbnRlbnRIZWlnaHQgfWApO1xyXG4gICAgdGhpcy5uYXRpdmVFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLWNvbnRlbnQtd2lkdGgnLCBgJHsgdGhpcy52aWV3cG9ydC5jb250ZW50V2lkdGggfWApO1xyXG4gICAgdGhpcy5uYXRpdmVFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZpZXdwb3J0LWhlaWdodCcsIGAkeyB0aGlzLnZpZXdwb3J0Lm9mZnNldEhlaWdodCB9YCk7XHJcbiAgICB0aGlzLm5hdGl2ZUVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmlld3BvcnQtd2lkdGgnLCBgJHsgdGhpcy52aWV3cG9ydC5vZmZzZXRXaWR0aCB9YCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==